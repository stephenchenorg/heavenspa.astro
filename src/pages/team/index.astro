---
import { seoMeta } from '@stephenchenorg/astro/page'
import Layout from '@/layouts/Layout.astro'
import SectionTitle from "../../components/ui/SectionTitle.astro";
import TeamCarousel from "../../components/ui/TeamCarousel.astro";
import { gql, graphQLAPI } from '@/api'
import type { TeamMember, TeamsResponse } from '@/types'

// GraphQL 查詢與錯誤處理
let teamMembers: TeamMember[] = []

try {
  const teamsData: TeamsResponse = await graphQLAPI(gql`
    query MyQuery {
      teams(sort_by: "asc", sort_column: "sort") {
        data {
          id
          images {
            created_at
            id
            image {
              desktop
              desktop_blur
              mobile
              mobile_blur
            }
            updated_at
            is_default
          }
          image {
            desktop
            desktop_blur
            mobile
            mobile_blur
          }
          tags {
            data {
              id
              title
              slug
            }
          }
          title
          category {
            title
          }
        }
      }
    }
  `)
  teamMembers = teamsData.teams.data || []
  console.log("teamMembers >> ",teamMembers)
} catch (error) {
}


const meta = seoMeta({
  title: '服務團隊 - Heaven Spa',
})
---

<Layout meta={meta}>
  <main class="section-container pt-32 min-h-screen">
    <!-- 標題區 -->
    <SectionTitle title="服務團隊" subtitle="OUR TEAM" />

    <!-- Tab Navigation -->
    <div class="max-w-4xl mx-auto mb-8">
      <div
          class="flex flex-wrap justify-center gap-2 p-2 rounded-xl min-w-[600px]"
          style="background-color: var(--color-neutral-100);"
      >
        <button
            class="tab-button px-6 py-3 rounded-lg font-medium transition-all duration-300 flex-1 min-w-0"
            data-tab="團隊一覽"
            style="color: var(--theme-text);"
        >
          團隊一覽
        </button>
        <button
            class="tab-button px-6 py-3 rounded-lg font-medium transition-all duration-300 flex-1 min-w-0"
            data-tab="今日可預約"
            style="color: var(--theme-text);"
        >
          今日可預約
        </button>
        <button
            class="tab-button px-6 py-3 rounded-lg font-medium transition-all duration-300 flex-1 min-w-0"
            data-tab="本週推薦"
            style="color: var(--theme-text);"
        >
          本週推薦
        </button>
        <button
            class="tab-button px-6 py-3 rounded-lg font-medium transition-all duration-300 flex-1 min-w-0"
            data-tab="新人"
            style="color: var(--theme-text);"
        >
          新人
        </button>
      </div>
    </div>
    <div class="min-w-6xl mx-auto">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        { teamMembers && teamMembers.map((member) => (
          <TeamCarousel 
            member={member} 
            showBadges={true} 
            showHoverMask={true}
            cardClass="p-4 group cursor-pointer w-full h-120"
            imageClass="carousel-container w-full h-120 bg-blue-200 mt-4 relative overflow-hidden"
          />
        )) }
      </div>
    </div>
  </main>
</Layout>

