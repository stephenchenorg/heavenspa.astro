---
// Member Benefits Section with Card Layout
import SectionTitle from '@/components/ui/SectionTitle.astro'
import {gql, graphQLAPI} from "../api";

export interface Article {
  id: number
  title: string
  category: ArticleCategory
  cover: Cover
  started_at: string
}
export interface ArticleCategory {
  title: string
}
export interface Cover {
  desktop: string
  desktop_blur: string
  mobile: string
  mobile_blur: string
}

export interface ArticlesResponse {
  articles: {
    data: Article[]
  }
}
let articles: Article[] = []

try {
  const articlesData: ArticlesResponse = await graphQLAPI(gql`
    query MyQuery {
      articles(is_newest:true, sort_by: "asc", sort_column: "sort") {
        data {
          cover {
            desktop
            desktop_blur
            mobile
            mobile_blur
          }
          title
          started_at
          category {
            title
          }
        }
      }
    }
  `)

  // 將 API 資料轉換為 Benefit 格式
  articles = (articlesData.articles.data || []).map((article: Article) => {
    const createdDate = new Date(article.started_at);
    return {
      id: article.id,
      title: article.title,
      started_at: article.started_at,
      date: createdDate.getDate().toString().padStart(2, '0'),
      year: createdDate.getFullYear().toString(),
      month: (createdDate.getMonth() + 1).toString().padStart(2, '0'),
      category: article.category,
      cover: article.cover,
    };
  });
} catch (error) {
  console.error('Failed to fetch team data:', error)
  // 如果 API 失敗，提供預設資料
  articles = [
    {
      id: 0,
      title: "Happy Mother's Day",
      started_at: "2025-05-01",
      category: { title: "限定母親節限定活動" },
      cover: {
        desktop: "https://hamahairspa.com/wp-content/uploads/2024/06/%E5%A4%A7young-woman-lying-down-with-traditional-hot-stones-along-spi-e1719460788846.jpeg",
        desktop_blur: "",
        mobile: "https://hamahairspa.com/wp-content/uploads/2024/06/%E5%A4%A7young-woman-lying-down-with-traditional-hot-stones-along-spi-e1719460788846.jpeg",
        mobile_blur: "",
      },
    },
    {
      id:0,
      title: "優惠活動",
      started_at: "2024-10-01",
      category: { title: "Special Offer" },
      cover: {
        desktop: "https://hamahairspa.com/wp-content/uploads/2024/06/%E5%A4%A7female-model-having-massage-spa.jpeg",
        desktop_blur: "",
        mobile: "https://hamahairspa.com/wp-content/uploads/2024/06/%E5%A4%A7female-model-having-massage-spa.jpeg",
        mobile_blur: "",
      },
    },
    {
      id: 0,
      title: "Hama 壽星關好禮",
      started_at: "2024-06-01",
      category: { title: "會員專屬" },
      cover: {
        desktop: "https://hamahairspa.com/wp-content/uploads/2024/06/%E5%A4%A7woman-spa-center.jpeg",
        desktop_blur: "",
        mobile: "https://hamahairspa.com/wp-content/uploads/2024/06/%E5%A4%A7woman-spa-center.jpeg",
        mobile_blur: "",
      },
    },
  ]
}
---

<section class="section-container" id="benefits" data-section="benefits">

  <!-- 標題區 -->
  <SectionTitle title="會員禮遇" subtitle="MEMBER BENEFITS" />

  <!-- Benefits Cards Grid -->
  <div class="max-w-7xl mx-auto w-full">
    <!-- 桌面和平板：網格布局 -->
    <div class="hidden sm:grid grid-cols-3 lg:grid-cols-3 md:grid-cols-2 gap-6 lg:gap-5 md:gap-6">
      {articles.map((article, index) => (
        <!-- Card 1: Happy Mother's Day -->
        <div class="group cursor-pointer transition-transform duration-300 hover:-translate-y-2">
        <div class="relative w-full aspect-[4/3] rounded-xl overflow-hidden mb-4 bg-gradient-to-br from-amber-100 to-amber-200">
          <!-- Background Image -->
          <div class="absolute inset-0 bg-[url('https://hamahairspa.com/wp-content/uploads/2024/06/%E5%A4%A7young-woman-lying-down-with-traditional-hot-stones-along-spi-e1719460788846.jpeg')] bg-cover bg-center opacity-80"></div>
          <div class="absolute inset-0 bg-black/40"></div>
          
          <!-- Date Badge -->
          <div class="absolute top-0 right-0 p-2 bg-[#D7AE54] text-center opacity-80">
            <span class="block text-white/80 text-sm font-light">{article.year}</span>
            <span class="block text-white text-4xl font-light">{article.month}</span>
          </div>

          <!-- Content -->
          <div class="absolute inset-0 p-6 flex flex-col justify-between text-white">
            <div>
              <h3 class="text-[1rem] font-light mb-2">{article.title}</h3>
            </div>
          </div>
          
          <!-- View More Button -->
          <div class="absolute bottom-4 left-6">
            <button class="bg-white/20 backdrop-blur-sm border border-white/30 text-white px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 hover:bg-white/30 flex items-center space-x-2">
              <span>{article.category.title}</span>
            </button>
          </div>
        </div>

        <!-- Card Info -->
        <div class="space-y-1">
          <div class="flex items-center justify-between">
            <button class="text-sm text-neutral-600 border border-neutral-300 px-3 py-1 rounded-full hover:bg-neutral-100 transition-colors duration-200 flex items-center space-x-1">
              <span>VIEW MORE</span>
              <span>→</span>
            </button>
          </div>
        </div>
      </div>
      ))}
    </div>

    <!-- 手機版：水平滾動布局 -->
    <div class="sm:hidden">
      <div class="flex gap-4 overflow-x-auto pb-4 scrollbar-hide -mx-6 px-6">
        {articles.map((article, index) => (
        <!-- Mobile Card 1 -->
        <div class="group cursor-pointer transition-transform duration-300 hover:-translate-y-2 flex-shrink-0 w-[300px]">
          <div class="relative w-full aspect-[4/3] rounded-xl overflow-hidden mb-4 bg-gradient-to-br from-amber-100 to-amber-200">
          <div class="absolute inset-0 bg-[url('https://hamahairspa.com/wp-content/uploads/2024/06/%E5%A4%A7young-woman-lying-down-with-traditional-hot-stones-along-spi-e1719460788846.jpeg')] bg-cover bg-center opacity-80"></div>
            <div class="absolute inset-0 bg-black/40"></div>

            <div class="absolute top-0 right-0 p-2 bg-[#D7AE54] text-center opacity-80">
              <span class="block text-white/80 text-sm font-light">{article.year}</span>
              <span class="block text-white text-4xl font-light">{article.month}</span>
            </div>
            
            <div class="absolute inset-0 p-6 flex flex-col justify-between text-white">
              <div>
                <h3 class="text-[0.8rem] font-light mb-2">{article.title}</h3>
              </div>
            </div>

            <div class="absolute bottom-4 left-6">
              <button class="bg-white/20 backdrop-blur-sm border border-white/30 text-white px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 hover:bg-white/30 flex items-center space-x-2">
                <span>{article.category.title}</span>
              </button>
            </div>
          </div>

          <div class="space-y-1">
            <button class="text-sm text-neutral-600 border border-neutral-300 px-3 py-1 rounded-full hover:bg-neutral-100 transition-colors duration-200 flex items-center space-x-1">
              <span>VIEW MORE</span>
              <span>→</span>
            </button>
          </div>
        </div>
        ))}

        <!-- Mobile Card 2 -->
        <div class="group cursor-pointer transition-transform duration-300 hover:-translate-y-2 flex-shrink-0 w-[300px]">
          <div class="relative w-full aspect-[4/3] rounded-xl overflow-hidden mb-4 bg-gradient-to-br from-orange-100 to-orange-200">
            <div class="absolute inset-0 bg-[url('https://hamahairspa.com/wp-content/uploads/2024/06/%E5%A4%A7female-model-having-massage-spa.jpeg')] bg-cover bg-center"></div>
            <div class="absolute inset-0 bg-orange-300/30"></div>
            
            <div class="absolute top-4 right-4 text-right">
              <span class="block text-white/80 text-sm font-light">2024</span>
              <span class="block text-white text-4xl font-light">10</span>
            </div>
            
            <div class="absolute inset-0 p-6 flex flex-col justify-between text-white">
              <div>
                <h3 class="text-xl font-light mb-2">優惠活動</h3>
                <p class="text-sm opacity-90 mb-1">Special Offer</p>
              </div>
              
              <div class="absolute bottom-4 left-6">
                <button class="bg-white/20 backdrop-blur-sm border border-white/30 text-white px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 hover:bg-white/30">
                  非會員優惠活動
                </button>
              </div>
            </div>
          </div>

          <div class="space-y-1">
            <button class="text-sm text-neutral-600 border border-neutral-300 px-3 py-1 rounded-full hover:bg-neutral-100 transition-colors duration-200 flex items-center space-x-1">
              <span>VIEW MORE</span>
              <span>→</span>
            </button>
          </div>
        </div>

        <!-- Mobile Card 3 -->
        <div class="group cursor-pointer transition-transform duration-300 hover:-translate-y-2 flex-shrink-0 w-[300px]">
          <div class="relative w-full aspect-[4/3] rounded-xl overflow-hidden mb-4 bg-gradient-to-br from-amber-100 to-amber-200">
            <div class="absolute inset-0 bg-[url('https://hamahairspa.com/wp-content/uploads/2024/06/%E5%A4%A7woman-spa-center.jpeg')] bg-cover bg-center"></div>
            <div class="absolute inset-0 bg-black/40"></div>
            
            <div class="absolute top-4 right-4 text-right">
              <span class="block text-white/80 text-sm font-light">2024</span>
              <span class="block text-white text-4xl font-light">06</span>
            </div>
            
            <div class="absolute inset-0 p-6 flex flex-col justify-between text-white">
              <div>
                <h3 class="text-xl font-medium mb-2">Hama<br>壽星關好禮</h3>
                <div class="bg-white text-black px-2 py-1 text-xs rounded inline-block mb-2">
                  會員專屬
                </div>
              </div>
              
              <div class="absolute bottom-4 left-6">
                <button class="bg-white/20 backdrop-blur-sm border border-white/30 text-white px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 hover:bg-white/30">
                  壽星關好禮
                </button>
              </div>
            </div>
          </div>

          <div class="space-y-1">
            <button class="text-sm text-neutral-600 border border-neutral-300 px-3 py-1 rounded-full hover:bg-neutral-100 transition-colors duration-200 flex items-center space-x-1">
              <span>VIEW MORE</span>
              <span>→</span>
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- 專屬優惠按鈕 (和參考圖片一樣) -->
  <div class="mt-12 max-w-7xl mx-auto w-full">
    <div class="flex justify-center">
      <button class="bg-primary-600 text-white px-8 py-4 rounded-full text-lg font-medium tracking-wide transition-all duration-300 hover:bg-primary-700 hover:scale-105">
        專屬優惠
      </button>
    </div>
  </div>

  <!-- Navigation Controls (like in the reference) -->
  <div class="flex justify-center mt-8 space-x-4">
    <button class="w-12 h-12 border-2 border-primary-600 bg-white rounded-full flex items-center justify-center text-primary-600 transition-all duration-300 hover:bg-primary-600 hover:text-white">
      <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M15 18l-6-6 6-6" />
      </svg>
    </button>
    <button class="w-12 h-12 border-2 border-primary-600 bg-white rounded-full flex items-center justify-center text-primary-600 transition-all duration-300 hover:bg-primary-600 hover:text-white">
      <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M9 18l6-6-6-6" />
      </svg>
    </button>
  </div>

</section>