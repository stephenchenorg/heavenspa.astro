---
import { getLocale } from 'i18n:astro'

const currentLocale = getLocale()

---

<div class="language-switcher flex">
  <button
    type="button"
    id="language-toggle-tw"
    class="flex items-center text-md font-medium tracking-wide transition-colors duration-200 hover:opacity-80 bg-transparent border-none cursor-pointer"
    style={`color: ${currentLocale === 'zh-TW' ? 'var(--color-primary-600, #c4a428)' : 'var(--theme-text)'}`}
    data-current-locale={currentLocale}
    data-target-locale="zh-TW"
  >
    繁中
  </button>
  <!--空格-->
  <span style="color: var(--theme-text)">&nbsp; / &nbsp;</span>
  <button
    type="button"
    id="language-toggle-en"
    class="flex items-center text-md font-medium tracking-wide transition-colors duration-200 hover:opacity-80 bg-transparent border-none cursor-pointer"
    style={`color: ${currentLocale === 'en' ? 'var(--color-primary-600, #c4a428)' : 'var(--theme-text)'}`}
    data-current-locale={currentLocale}
    data-target-locale="en"
  >
    EN
  </button>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const toggleButtons = document.querySelectorAll('[id^="language-toggle-"]')

    toggleButtons.forEach(button => {
      button.addEventListener('click', () => {
        const targetLocale = button.getAttribute('data-target-locale')
        const currentLocale = button.getAttribute('data-current-locale')

        // 如果點擊的是當前語言，不做任何動作
        if (targetLocale === currentLocale) return

        // 獲取完整的當前 URL（包含 query string 和 hash）
        const fullPath = window.location.pathname + window.location.search + window.location.hash

        // 移除現有的語言前綴（如果有）
        const basePath = fullPath.replace(/^\/en(\/|$)/, '/')

        // 根據目標語言決定跳轉
        if (targetLocale === 'en') {
          // 切換到英文：加上 /en 前綴
          window.location.href = `/en${basePath}`
        } else {
          // 切換到中文（默認語言）：使用沒有前綴的路徑
          window.location.href = basePath
        }
      })
    })
  })
</script>
