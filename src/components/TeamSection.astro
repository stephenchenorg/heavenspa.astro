---
import {gql, graphQLAPI} from '@/api'

// 定義 API 回應的類型
export interface TeamCover {
  desktop: string
  desktop_blur: string
  mobile: string
  mobile_blur: string
}

export interface TeamCategory {
  title: string
}

export interface TeamMember {
  title: string
  category: TeamCategory
  cover: TeamCover
}

export interface TeamsResponse {
  teams: {
    data: TeamMember[]
  }
}

// GraphQL 查詢與錯誤處理
let teamMembers: TeamMember[] = []

try {
  const teamsData: TeamsResponse = await graphQLAPI(gql`
    query MyQuery {
      teams(sort_by: "asc", sort_column: "sort") {
        data {
          cover {
            desktop
            desktop_blur
            mobile
            mobile_blur
          }
          title
          category {
            title
          }
        }
      }
    }
  `)

  teamMembers = teamsData.teams.data || []
} catch (error) {
  console.error('Failed to fetch team data:', error)
  // 如果 API 失敗，提供預設資料
  teamMembers = [
    {
      title: '專業團隊',
      category: {title: '服務專員'},
      cover: {
        desktop: '/images/default-team.jpg',
        desktop_blur: '/images/default-team-blur.jpg',
        mobile: '/images/default-team-mobile.jpg',
        mobile_blur: '/images/default-team-mobile-blur.jpg',
      },
    },
  ]
}
---

<section
  class="relative z-10 w-full min-h-screen flex flex-col justify-center bg-white py-16 px-4 lg:px-16 md:px-4 sm:px-4"
  id="team" data-section="team">
  <div class="mx-auto w-[70vw] px-8 text-center lg:w-[85vw] md:w-[90vw] md:px-4 sm:w-[95vw] sm:px-4 xs:px-2">
    <div class="mb-6 md:mb-12 sm:mb-8">
      <h2 class="mb-4 text-[3.5rem] lg:text-[3rem] md:text-[2.5rem] sm:text-[2rem] font-light text-black tracking-[6px] lg:tracking-[4px] md:tracking-[3px] sm:tracking-[2px]">
        我們的團隊</h2>
      <h3 class="text-2xl md:text-xl sm:text-base text-neutral-600 font-normal tracking-[2px] uppercase mb-4">OUR TEAM</h3>
      <p class="mx-auto max-w-[500px] text-sm leading-relaxed text-neutral-600 sm:text-base sm:px-0">
        嚴選頂尖團隊，成為最懂你的那雙手
      </p>
    </div>

    <div
      class="mx-auto mb-4 grid flex-1 content-center justify-items-center gap-2 grid-cols-3 lg:grid-cols-2 lg:gap-4 md:grid-cols-1 md:gap-6 sm:gap-4">
      {teamMembers.map(member => (
        <div class="text-center transition-transform duration-300 ease-out hover:-translate-y-1">
          <div
            class="relative mx-auto mb-4 h-[200px] w-[200px] flex-shrink-0 overflow-hidden rounded-lg lg:h-[250px] lg:w-[250px] md:h-[300px] md:w-[300px] sm:h-[250px] sm:w-[250px] xs:h-[220px] xs:w-[220px]">
            <picture>
              <source media="(max-width: 768px)" srcset={member.cover.mobile}/>
              <img
                src={member.cover.desktop}
                alt={member.title}
                loading="lazy"
                onload="this.style.filter='none'"
                style="filter: blur(10px); transition: filter 0.3s ease;"
                class="h-full w-full object-cover grayscale transition-all duration-300 ease-out hover:grayscale-0"
              />
            </picture>
          </div>
          <div class="text-center">
            <h3 class="mb-1 text-base font-bold uppercase tracking-wide text-black sm:text-base">{member.title}</h3>
            <p class="text-sm font-normal text-primary-500 sm:text-[0.9rem]">{member.category.title}</p>
          </div>
        </div>
      ))}
    </div>
  </div>

  <!-- 跑馬燈區塊 -->
  <div
    class="relative z-[100] mt-auto w-full flex-shrink-0 overflow-hidden whitespace-nowrap bg-neutral-100 px-0 py-4 clear-both md:relative md:z-[200] md:mt-16 md:py-6 sm:relative sm:z-[300] sm:mt-12 sm:border-t sm:border-primary-500/20 sm:py-6 xs:relative xs:z-[400] xs:mt-8">
    <div class="inline-block animate-marquee">
      <span
        class="text-base font-medium uppercase tracking-wide text-neutral-700 md:text-base md:tracking-wider sm:text-sm sm:tracking-normal xs:text-sm">
        {teamMembers.map(member => (
          `${member.title} • `
        )).join('')}
        {teamMembers.map(member => (
          `${member.title} • `
        )).join('')}
      </span>
    </div>
  </div>
</section>

