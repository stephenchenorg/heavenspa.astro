---
import { getArticles } from '@/api/articles'
import { createNestedT } from '@/utils/i18n'
import Carousel from './ui/Carousel.astro'
import SectionTitle from './ui/SectionTitle.astro'
import Button from '@/components/ui/Button.astro'

const t = await createNestedT()

let articles = await getArticles()
articles = articles.slice(0, 6) // 只取前6筆資料

---

<section class="section-container-index" id="benefits" data-section="benefits">
  <!-- 標題區 -->
  <SectionTitle title="最新消息" subtitle="News" />

  <!-- 響應式輪播 -->
  <div class="max-w-7xl mx-auto w-full mt-8">
    {articles.length > 0 ? (
      <Carousel
        itemCount={articles.length}
        uniqueId="news"
        autoPlayInterval={5000}
      >
        {articles.map((article, articleIndex) => (
          <div
            class="carousel-slide flex-shrink-0 w-full md:w-1/2 lg:w-1/3"
            data-slide={articleIndex}
          >
            <div class="px-2">
              <div
                class="group cursor-pointer transition-transform duration-300 hover:-translate-y-2 relative"
                onclick={`window.location.href='/news/${article.id}'`}
              >
                <div class="relative w-full h-[400px] aspect-square overflow-hidden mb-4">
                  <!-- Background Image -->
                  <div
                    class="absolute inset-0 bg-cover bg-center"
                    style={`background-image: url('${article.cover || 'https://hamahairspa.com/wp-content/uploads/2024/06/%E5%A4%A7young-woman-lying-down-with-traditional-hot-stones-along-spi-e1719460788846.jpeg'}')`}
                  ></div>
                  <!-- Base Overlay for better text readability -->
                  <div class="absolute inset-0 bg-black/30"></div>
                  <!-- Hover Overlay -->
                  <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>

                  <!-- Date Badge -->
                  <div class="absolute top-0 right-0 p-2 bg-[#D7AE54] text-center opacity-80">
                    <span class="block text-white/80 text-sm font-light">{article.year}</span>
                    <span class="block text-white text-4xl font-light">{article.month}</span>
                  </div>

                  <!-- Content -->
                  <div class="absolute inset-0 p-6 flex flex-col justify-between text-white">
                    <div class="flex flex-col space-y-3">
                      <!-- 標題 -->
                      <div class="space-y-1">
                        <h3
                          class="text-xl lg:text-2xl font-bold leading-tight tracking-wide text-white"
                          style="text-shadow: 2px 2px 8px rgba(0,0,0,0.8), 1px 1px 3px rgba(0,0,0,0.9);"
                        >
                          {article.title}
                        </h3>
                        <div class="w-12 h-0.5 bg-gradient-to-r from-white to-transparent rounded-full opacity-80 shadow-sm"></div>
                      </div>
                    </div>

                    <!-- 底部行動召喚 -->
                    { article.started_at && (
                        <div class="flex items-center justify-betㄙween">
                          <div class="text-xs opacity-75">
                            <span>{t('news.publishDate')} {article.started_at}</span>
                          </div>
                        </div>
                    )}
                  </div>

                  <!-- VIEW MORE Button Overlay -->
                  <Button
                      variant="ghost"
                      text={t('buttons.view-more')}
                      size="small"
                      icon="→"
                      wrapperClass="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300"
                  />
                </div>
              </div>
            </div>
          </div>
        ))}
      </Carousel>
    ) : (
      <div class="flex flex-col items-center justify-center py-16 px-4">
        <div class="text-center max-w-md mx-auto">
          <!-- 圖示 -->
          <div class="mb-6">
            <svg
              class="w-20 h-20 mx-auto text-gray-300"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="1"
                d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2M4 13h2m13-8v.01M6 8v.01"
              ></path>
            </svg>
          </div>

          <!-- 主要訊息 -->
          <h3 class="text-2xl font-semibold text-gray-600 mb-3">
            暫時無會員禮遇資訊
          </h3>

          <!-- 副標題 -->
          <p class="text-gray-500 mb-6 leading-relaxed">
            目前沒有可顯示的會員禮遇活動，請稍後再來查看最新優惠資訊。
          </p>

        </div>
      </div>
    )}
  </div>

  <!-- 只在有資料時顯示的按鈕區域 -->
  {articles.length > 0 && (
    <div class="mt-12 max-w-7xl mx-auto w-full">
      <Button href="/news" variant="outline" size="medium" text={t('news.more-news')} />
    </div>
  )}

</section>
