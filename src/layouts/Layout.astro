---
import type { PageMeta } from '@stephenchenorg/astro/page'
import type { CompanySetting } from '@/types'
import { gql, graphQLAPI } from '@/api'
import FloatingContactSidebar from '@/components/FloatingContactSidebar.vue'
import ThemeController from '@/components/ThemeController.astro'
import BaseLayout from '@/layouts/BaseLayout.astro'
import Footer from '@/layouts/partials/Footer.astro'
import Header from '@/layouts/partials/Header.astro'

interface Props {
  // metadata
  meta: PageMeta

  // layout props
  // ...
}

const data: CompanySetting = await graphQLAPI(gql`
  query GetCompanySetting {
    companySetting {
      address_1
      address_2
      description
      email_1
      email_2
      fb_link
      ig_link
      lang
      line_link
      whatsapp_link
      twitter_link
      logo
      name
      phone_1
      phone_2
      tg_link
      vat
    }
  }
`)

const {
  meta,
} = Astro.props

---

<BaseLayout meta={meta}>
  <Header companySetting={data.companySetting} />

  <slot />

  <Footer companySetting={data.companySetting} />

  {(data.companySetting.phone_1 || data.companySetting.whatsapp_link || data.companySetting.line_link) && (
    <FloatingContactSidebar 
      client:load 
      companySetting={data.companySetting}
    />
  )}
  
  <!-- Theme Controller -->
  <!--<ThemeController />-->
</BaseLayout>
