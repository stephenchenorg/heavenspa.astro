---
import type { PageMeta } from '@stephenchenorg/astro/page'
import BaseLayout from '@/layouts/BaseLayout.astro'
import Footer from '@/layouts/partials/Footer.astro'
import Header from '@/layouts/partials/Header.astro'
import FloatingContactSidebar from '@/components/FloatingContactSidebar.vue'
import { getCompanySetting } from '@/api/companySetting'
import { getLocale } from 'i18n:astro'

// 使用 @astrolicious/i18n 的 getLocale() 函數
const locale = getLocale()
const companySetting = await getCompanySetting(locale)

interface Props {
  // metadata
  meta: PageMeta

  // layout props
  // ...
}

const {
  meta,
} = Astro.props

---

<BaseLayout meta={meta}>
  <div class="w-full" style="background: var(--theme-bg, #0a0a0a); color: var(--theme-text, #ffffff);">
    <Header companySetting={companySetting} />

    <slot />

    <Footer companySetting={companySetting}/>

    <FloatingContactSidebar
      client:load
      companySetting={companySetting}
    />
  </div>

  <!-- Theme Controller -->
  <!--<ThemeController />-->

  <!-- 清理語系切換後的 URL 參數 -->
  <script>
    // 檢查 URL 是否包含 lang 參數
    const url = new URL(window.location.href)
    const hasLangParam = url.searchParams.has('lang')
    
    if (hasLangParam) {
      // 移除 lang 參數
      url.searchParams.delete('lang')
      
      // 使用 history.replaceState 更新 URL，不會觸發頁面重新載入
      window.history.replaceState({}, '', url.toString())
      
      console.log('語系參數已從 URL 中清理')
    }
  </script>
</BaseLayout>
