---
import { seoMeta } from '@stephenchenorg/astro/page'
import { getArticle } from '@/api/articles'
import Prose from '@/components/ui/Prose.vue'
import Layout from '@/layouts/Layout.astro'
import { createNestedT } from '@/utils/i18n'

const t = await createNestedT()
const { id } = Astro.params
if (!id || Number.isNaN(Number(id))) {
  return Astro.rewrite('/404')
}

// 如果找不到文章，創建一個預設的文章物件
const defaultArticle = {
  id: 0,
  title: '文章未找到',
  content: '<p>很抱歉，您請求的文章不存在或已被移除。</p><p>請返回新聞列表頁面查看其他文章。</p>',
  cover: 'https://hamahairspa.com/wp-content/uploads/2024/06/%E5%A4%A7young-woman-lying-down-with-traditional-hot-stones-along-spi-e1719460788846.jpeg',
}

const article = await getArticle(id) || defaultArticle

const meta = seoMeta({
  title: `${article.title} - Heaven Spa`,
  description: article.content ? article.content.replace(/<[^>]*>/g, '').substring(0, 160) : '了解 Heaven Spa 的最新消息',
})
---

<Layout meta={meta}>
  <main class="min-h-screen pt-32" style="background: var(--theme-bg, #ffffff); color: var(--theme-text, #000000);">
    <!-- Hero Banner -->
    <section class="relative aspect-[1920/600] overflow-hidden">
      <div class="absolute inset-0 ">
        <img
          src={article.cover || 'https://hamahairspa.com/wp-content/uploads/2024/06/%E5%A4%A7young-woman-lying-down-with-traditional-hot-stones-along-spi-e1719460788846.jpeg'}
          alt={article.title}
          class="object-cover w-full h-full"
        />
        <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-black/10"></div>
      </div>
    </section>

    <!-- Article Content -->
    <section class="py-8">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Breadcrumb Navigation -->
        <nav class="mb-6">
          <ol class="flex items-center space-x-2 text-sm" style="color: var(--theme-text-secondary);">
            <li><a href="/" class="transition-colors hover:underline" style="color: var(--theme-text-secondary);">{t('news.breadcrumb.home')}</a></li>
            <li><span style="color: var(--theme-text-muted);">/</span></li>
            <li><a href="/news" class="transition-colors hover:underline" style="color: var(--theme-text-secondary);">{t('news.breadcrumb.news')}</a></li>
            <li><span style="color: var(--theme-text-muted);">/</span></li>
            <li class="truncate max-w-xs" style="color: var(--theme-text);">{article.title || t('news.detail')}</li>
          </ol>
        </nav>

        <!-- Article Title -->
        <div class="my-8">
          <h1 class="text-2xl md:text-3xl lg:text-4xl font-bold leading-tight" style="color: var(--theme-text, #1f2937);">
            {article.title}
          </h1>
        </div>

        <!-- Article Content -->
        <article class="prose prose-lg max-w-none my-8 border-t pt-8" style="color: var(--theme-text); border-color: var(--theme-border);">
          <Prose sourceDoc={article.content || ''} client:load />
        </article>

        <!-- Date Info -->
        <div class="mb-8 py-8 border-y" style="border-color: var(--theme-border);">
          <div class="flex items-center justify-center space-x-4 text-sm" style="color: var(--theme-text-secondary);">
            <div class="flex items-center justify-center space-x-2">
              <svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              <span>{t('news.publishDate')} {new Date(article.started_at || new Date()).toLocaleDateString('zh-TW')}</span>
            </div>
            {article.ended_at && (
              <>
                <span>•</span>
                <div class="flex items-center space-x-2">
                  <span>{t('news.endDate')} {new Date(article.ended_at).toLocaleDateString('zh-TW')}</span>
                </div>
              </>
            )}
          </div>
        </div>

        <!-- Back to News Button -->
        <div class="flex items-center justify-center space-x-2">
            <a
              href="/news"
              class="inline-flex items-center space-x-2 transition-all duration-300 group px-6 py-3 text-white rounded-lg shadow-sm font-medium hover:shadow-lg hover:-translate-y-0.5"
              style="background-color: var(--color-primary-500);"
            >
              <svg class="w-5 h-5 transform group-hover:-translate-x-1 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
              <span>{t('news.backToNews')}</span>
            </a>
        </div>
      </div>
    </section>
  </main>
</Layout>
