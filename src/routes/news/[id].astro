---
import {seoMeta} from '@stephenchenorg/astro/page'
import {getArticle} from '@/api/articles'
import Prose from '@/components/ui/Prose.vue'
import Layout from '@/layouts/Layout.astro'
import {createNestedT} from '@/utils/i18n'
import Badge from "../../components/ui/Badge.astro";

const t = await createNestedT()
const {id} = Astro.params
if (!id || Number.isNaN(Number(id))) {
    return Astro.rewrite('/404')
}

// 如果找不到文章，創建一個預設的文章物件
const defaultArticle = {
    id: 0,
    title: '文章未找到',
    content: '<p>很抱歉，您請求的文章不存在或已被移除。</p><p>請返回新聞列表頁面查看其他文章。</p>',
    cover: 'https://hamahairspa.com/wp-content/uploads/2024/06/%E5%A4%A7young-woman-lying-down-with-traditional-hot-stones-along-spi-e1719460788846.jpeg',
}

const article = await getArticle(id) || defaultArticle

const meta = seoMeta({
    title: `${article.title} - Heaven Spa`,
    description: article.content ? article.content.replace(/<[^>]*>/g, '').substring(0, 160) : '了解 Heaven Spa 的最新消息',
})
---

<Layout meta={meta}>
    <!-- Hero Banner -->
    <section class="relative aspect-[1920/600] overflow-hidden">
        <div class="absolute inset-0">
            <img
                    src={article.cover || 'https://hamahairspa.com/wp-content/uploads/2024/06/%E5%A4%A7young-woman-lying-down-with-traditional-hot-stones-along-spi-e1719460788846.jpeg'}
                    alt={article.title}
                    class="object-cover w-full h-full"
            />
            <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-black/10"></div>
        </div>

        <!-- Hero Content Overlay -->
        <div class="absolute inset-0 flex items-center justify-center">
            <div class="text-center text-white px-4 sm:px-6 lg:px-8">
                <!-- Main Title - Center -->
                <h1 class="text-2xl sm:text-3xl lg:text-5xl xl:text-6xl font-bold leading-tight tracking-wide mb-8">
                    {article.title}
                </h1>

                <!-- Meta Information - Below Title -->
                <div class="flex flex-col sm:flex-row sm:items-center justify-center gap-4 text-sm">
                    <!-- Date -->
                    <div class="flex items-center justify-center space-x-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span>{new Date(article.started_at || new Date()).toLocaleDateString('zh-TW')}</span>
                    </div>

                    <!-- Author -->
                    {(article.author) && (
                            <div class="flex items-center justify-center space-x-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                </svg>
                                <span>{article.author}</span>
                            </div>
                    )}

                    <!-- Tags -->
                    <div class="flex items-center justify-center space-x-2">
              <span class="px-3 py-1 text-xs font-medium rounded-full bg-white/20 backdrop-blur-sm border border-white/20">
                美容保養
              </span>
                        <span class="px-3 py-1 text-xs font-medium rounded-full bg-white/20 backdrop-blur-sm border border-white/20">
                健康生活
              </span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <main class="section-container" style="background: var(--theme-bg, #ffffff); color: var(--theme-text, #000000);">
        <!-- Main Content Area with Sidebar Layout -->
        <section class="py-8">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                    <!-- Left Content - 3/5 (60%) -->
                    <div class="lg:col-span-3">
                        <!-- Image Gallery Carousel -->
                        <div class="mb-12">
                            <div class="relative">
                                <!-- Carousel Container -->
                                <div class="relative aspect-[800/544] overflow-hidden rounded-lg shadow-lg"
                                     style="background: var(--theme-card-bg);">
                                    <!-- Slides -->
                                    <div class="carousel-track flex transition-transform duration-500 ease-in-out h-full">
                                        <!-- Sample Images - Replace with actual article images -->
                                        <div class="carousel-slide flex-shrink-0 w-full h-full relative">
                                            <img
                                                    src="https://imagefaker.access.mx.com/800x544/d4af37/ffffff/?text=Image+1"
                                                    alt="Gallery image 1"
                                                    class="w-full h-full object-cover"
                                                    loading="lazy"
                                            />
                                        </div>
                                        <div class="carousel-slide flex-shrink-0 w-full h-full relative">
                                            <img
                                                    src="https://imagefaker.access.mx.com/800x544/c4a428/ffffff/?text=Image+2"
                                                    alt="Gallery image 2"
                                                    class="w-full h-full object-cover"
                                                    loading="lazy"
                                            />
                                        </div>
                                        <div class="carousel-slide flex-shrink-0 w-full h-full relative">
                                            <img
                                                    src="https://imagefaker.access.mx.com/800x544/b8941f/ffffff/?text=Image+3"
                                                    alt="Gallery image 3"
                                                    class="w-full h-full object-cover"
                                                    loading="lazy"
                                            />
                                        </div>
                                    </div>

                                    <!-- Navigation Arrows -->
                                    <button
                                            class="carousel-prev absolute left-4 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-black/50 text-white flex items-center justify-center hover:bg-black/70 transition-colors duration-200"
                                            aria-label="Previous image"
                                    >
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                  d="M15 19l-7-7 7-7"/>
                                        </svg>
                                    </button>
                                    <button
                                            class="carousel-next absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-black/50 text-white flex items-center justify-center hover:bg-black/70 transition-colors duration-200"
                                            aria-label="Next image"
                                    >
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                  d="M9 5l7 7-7 7"/>
                                        </svg>
                                    </button>

                                    <!-- Dots Indicator -->
                                    <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2">
                                        <button
                                                class="carousel-dot w-3 h-3 rounded-full transition-all duration-200 bg-white"
                                                data-slide="0"
                                                aria-label="Go to slide 1"
                                        ></button>
                                        <button
                                                class="carousel-dot w-3 h-3 rounded-full transition-all duration-200 bg-white/50"
                                                data-slide="1"
                                                aria-label="Go to slide 2"
                                        ></button>
                                        <button
                                                class="carousel-dot w-3 h-3 rounded-full transition-all duration-200 bg-white/50"
                                                data-slide="2"
                                                aria-label="Go to slide 3"
                                        ></button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Article Content -->
                        <article class="prose prose-lg max-w-none my-8" style="color: var(--theme-text);">
                            <Prose sourceDoc={article.content || ''} client:load/>
                        </article>

                        <!-- Date Info -->
                        <div class="mb-8 py-8 border-y" style="border-color: var(--theme-border);">
                            <div class="flex items-center justify-center space-x-4 text-sm"
                                 style="color: var(--theme-text-secondary);">
                                <div class="flex items-center justify-center space-x-2">
                                    <svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor"
                                         viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                    <span>{t('news.publishDate')} {new Date(article.started_at || new Date()).toLocaleDateString('zh-TW')}</span>
                                </div>
                                {article.ended_at && (
                                        <>
                                            <span>•</span>
                                            <div class="flex items-center space-x-2">
                                                <span>{t('news.endDate')} {new Date(article.ended_at).toLocaleDateString('zh-TW')}</span>
                                            </div>
                                        </>
                                )}
                            </div>
                        </div>

                        <!-- Back to News Button -->
                        <div class="flex items-center justify-center space-x-2">
                            <a
                                    href="/news"
                                    class="inline-flex items-center space-x-2 transition-all duration-300 group px-6 py-3 text-white rounded-lg shadow-sm font-medium hover:shadow-lg hover:-translate-y-0.5"
                                    style="background-color: var(--color-primary-500);"
                            >
                                <svg class="w-5 h-5 transform group-hover:-translate-x-1 transition-transform duration-300"
                                     fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M15 19l-7-7 7-7"></path>
                                </svg>
                                <span>{t('news.backToNews')}</span>
                            </a>
                        </div>
                    </div>

                    <!-- Right Sidebar - 2/5 (40%) -->
                    <div class="lg:col-span-2">
                        <div class="sticky top-8 space-y-8">
                            <!--&lt;!&ndash; Article Information &ndash;&gt;-->
                            <!--<div class="p-6 rounded-lg shadow-lg" style="background: var(&#45;&#45;theme-card-bg); border: 1px solid var(&#45;&#45;theme-border);">-->
                            <!--  <h3 class="text-lg font-semibold mb-4" style="color: var(&#45;&#45;theme-text);">文章資訊</h3>-->
                            <!--  <div class="space-y-4">-->
                            <!--    <div class="flex items-center space-x-3">-->
                            <!--      <svg class="w-5 h-5 flex-shrink-0" style="color: var(&#45;&#45;color-primary-500);" fill="none" stroke="currentColor" viewBox="0 0 24 24">-->
                            <!--        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />-->
                            <!--      </svg>-->
                            <!--      <span class="text-sm" style="color: var(&#45;&#45;theme-text-secondary);">作者：{article.author || '編輯部'}</span>-->
                            <!--    </div>-->
                            <!--    <div class="flex items-center space-x-3">-->
                            <!--      <svg class="w-5 h-5 flex-shrink-0" style="color: var(&#45;&#45;color-primary-500);" fill="none" stroke="currentColor" viewBox="0 0 24 24">-->
                            <!--        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />-->
                            <!--      </svg>-->
                            <!--      <span class="text-sm" style="color: var(&#45;&#45;theme-text-secondary);">發布日期：{new Date(article.started_at || new Date()).toLocaleDateString('zh-TW')}</span>-->
                            <!--    </div>-->
                            <!--    <div class="pt-4 border-t" style="border-color: var(&#45;&#45;theme-border);">-->
                            <!--      <div class="flex flex-wrap gap-2">-->
                            <!--        <span class="px-3 py-1 text-xs font-medium rounded-full" style="background-color: var(&#45;&#45;color-primary-100); color: var(&#45;&#45;color-primary-700);">-->
                            <!--          美容保養-->
                            <!--        </span>-->
                            <!--        <span class="px-3 py-1 text-xs font-medium rounded-full" style="background-color: var(&#45;&#45;color-secondary-100); color: var(&#45;&#45;color-secondary-700);">-->
                            <!--          健康生活-->
                            <!--        </span>-->
                            <!--      </div>-->
                            <!--    </div>-->
                            <!--  </div>-->
                            <!--</div>-->

                            <!-- Related Articles -->
                            <div class="pb-6 px-6">
                                <h3 class="text-lg font-semibold mb-4 pb-4"
                                    style="border-bottom: 1px solid var(--theme-border); color: var(--theme-text);">
                                    相關文章</h3>
                                <div class="space-y-4">
                                    <a href="/news/1" class="block group">
                                        <div class="flex space-x-3">
                                            <img
                                                    src="https://imagefaker.access.mx.com/80x60/d4af37/ffffff/?text=News+1"
                                                    alt="Related article"
                                                    class="w-20 h-15 object-cover rounded flex-shrink-0"
                                            />
                                            <div class="flex-1 min-w-0">
                                                <h4 class="text-sm font-medium line-clamp-2 group-hover:underline"
                                                    style="color: var(--theme-text);">
                                                    深度放鬆 SPA 療程，讓身心獲得完全舒緩
                                                </h4>
                                                <p class="text-xs mt-1" style="color: var(--theme-text-secondary);">
                                                    2024-12-15</p>
                                            </div>
                                        </div>
                                    </a>
                                    <a href="/news/2" class="block group">
                                        <div class="flex space-x-3">
                                            <img
                                                    src="https://imagefaker.access.mx.com/80x60/c4a428/ffffff/?text=News+2"
                                                    alt="Related article"
                                                    class="w-20 h-15 object-cover rounded flex-shrink-0"
                                            />
                                            <div class="flex-1 min-w-0">
                                                <h4 class="text-sm font-medium line-clamp-2 group-hover:underline"
                                                    style="color: var(--theme-text);">
                                                    精油按摩的神奇功效，舒緩壓力提升生活品質
                                                </h4>
                                                <p class="text-xs mt-1" style="color: var(--theme-text-secondary);">
                                                    2024-12-12</p>
                                            </div>
                                        </div>
                                    </a>
                                    <a href="/news/3" class="block group">
                                        <div class="flex space-x-3">
                                            <img
                                                    src="https://imagefaker.access.mx.com/80x60/b8941f/ffffff/?text=News+3"
                                                    alt="Related article"
                                                    class="w-20 h-15 object-cover rounded flex-shrink-0"
                                            />
                                            <div class="flex-1 min-w-0">
                                                <h4 class="text-sm font-medium line-clamp-2 group-hover:underline"
                                                    style="color: var(--theme-text);">
                                                    臉部護理專業技巧，打造水潤透亮肌膚
                                                </h4>
                                                <p class="text-xs mt-1" style="color: var(--theme-text-secondary);">
                                                    2024-12-10</p>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            </div>

                            <!-- Quick Contact -->
                            <div class="pb-6 px-6">
                                <h3 class="text-lg font-semibold mb-4 pb-4"
                                    style="border-bottom: 1px solid var(--theme-border); color: var(--theme-text);">
                                    Tags</h3>
                                <div class="flex flex-wrap gap-2">
                                    <span class="rounded-md px-3 py-2 text-sm transition-all duration-200 cursor-pointer border hover:border-primary-500 hover:bg-primary-50"
                                          style=" background: var(--theme-card-bg);">美容保養</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const carouselTrack = document.querySelector('.carousel-track')
            const slides = document.querySelectorAll('.carousel-slide')
            const prevButton = document.querySelector('.carousel-prev')
            const nextButton = document.querySelector('.carousel-next')
            const dots = document.querySelectorAll('.carousel-dot')

            if (!carouselTrack || slides.length === 0) return

            let currentIndex = 0
            const totalSlides = slides.length

            // Update carousel position
            function updateCarousel() {
                const translateX = -currentIndex * 100
                ;(carouselTrack as HTMLElement).style.transform = `translateX(${translateX}%)`

                // Update dots
                dots.forEach((dot, index) => {
                    if (index === currentIndex) {
                        dot.classList.remove('bg-white/50')
                        dot.classList.add('bg-white')
                    } else {
                        dot.classList.remove('bg-white')
                        dot.classList.add('bg-white/50')
                    }
                })
            }

            // Next slide
            function nextSlide() {
                currentIndex = (currentIndex + 1) % totalSlides
                updateCarousel()
            }

            // Previous slide
            function prevSlide() {
                currentIndex = (currentIndex - 1 + totalSlides) % totalSlides
                updateCarousel()
            }

            // Go to specific slide
            function goToSlide(index: number) {
                currentIndex = index
                updateCarousel()
            }

            // Event listeners
            if (nextButton) {
                nextButton.addEventListener('click', nextSlide)
            }

            if (prevButton) {
                prevButton.addEventListener('click', prevSlide)
            }

            dots.forEach((dot, index: number) => {
                dot.addEventListener('click', () => goToSlide(index))
            })

            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft') prevSlide()
                if (e.key === 'ArrowRight') nextSlide()
            })

            // Auto-play (optional)
            let autoPlayInterval = setInterval(nextSlide, 5000)

            // Pause auto-play on hover
            const carouselContainer = document.querySelector('.relative.max-w-\\[800px\\]')
            if (carouselContainer) {
                carouselContainer.addEventListener('mouseenter', () => {
                    clearInterval(autoPlayInterval)
                })

                carouselContainer.addEventListener('mouseleave', () => {
                    autoPlayInterval = setInterval(nextSlide, 5000)
                })
            }
        })
    </script>

    <style>
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</Layout>
