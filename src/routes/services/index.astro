---
import { seoMeta } from '@stephenchenorg/astro/page'
import { getLocale } from 'i18n:astro'
import { getServiceCategories } from '@/api/serviceCategories'
import Layout from '@/layouts/Layout.astro'
import { createNestedT } from '@/utils/i18n'
import SectionTitle from '../../components/ui/SectionTitle.astro'

const t = await createNestedT()
const currentLocale = getLocale()
const isEnglish = currentLocale === 'en'

const meta = seoMeta({
  title: t('services.pageTitle'),
})

const data = await getServiceCategories()
const services = data.serviceCategories.data
---

<Layout meta={meta}>
  <main class="section-container mb-0 pb-0">

    <!-- 標題區 -->
    <SectionTitle title={t('services.title')} subtitle={t('services.subtitle')} />
    <section
      class="w-full min-h-[calc(100vh-8rem)] flex flex-col"
      aria-label="服務項目列表"
    >
      <div class="mt-8 grid flex-1 grid-cols-1 lg:grid-cols-3 gap-0">
        {services.map(service => (
            <a href={`/services/${service.id}/items`} class="group relative flex h-full items-end overflow-hidden service-card">
              {/* 背景圖片 */}
              <div
                class="service-background absolute top-0 left-0 h-full w-[130%] bg-center bg-cover transition-transform duration-[1200ms] ease-out group-hover:-translate-x-24"
                style={`background-image: url(${service.cover?.desktop})`}
              />
                {/* 漸層遮罩 */}
                <div class="pointer-events-none absolute inset-0 bg-gradient-to-t from-black/40 to-black/20 transition-opacity duration-500 group-hover:from-black/60 group-hover:to-black/20" />

                {/* 文字內容 */}
                <div class="relative z-[1] flex w-full flex-col gap-4 p-8 md:p-10 justify-between h-full">
                  <p class={`font-semibold tracking-tight ${isEnglish ? 'text-[clamp(1rem,3vw,1.5rem)]' : 'text-[clamp(1.25rem,4vw,2rem)]'}`}>{service.title}</p>
                </div>
            </a>
        ))}
      </div>
    </section>
  </main>
</Layout>

<style>
  /* Line clamp utility for English descriptions */
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* English language optimizations for Services index */
  .services-en-title {
    word-break: break-word;
    hyphens: auto;
    line-height: 1.1;
    letter-spacing: -0.01em;
  }

  .services-en-description {
    word-break: break-word;
    hyphens: auto;
    line-height: 1.3;
  }

  /* Responsive adjustments for English content */
  @media (max-width: 768px) {
    .services-en-title {
      font-size: 1.5rem;
      line-height: 1.1;
    }

    .services-en-description {
      font-size: 0.75rem;
      line-height: 1.2;
    }
  }

  @media (max-width: 640px) {
    .services-en-title {
      font-size: 1.25rem;
      line-height: 1.1;
    }

    .services-en-description {
      font-size: 0.7rem;
      line-height: 1.2;
    }
  }

  /* Better spacing for service cards in English */
  .service-card-english {
    padding: 1.5rem 1.75rem;
  }

  @media (min-width: 768px) {
    .service-card-english {
      padding: 2rem 2.25rem;
    }
  }

  /* Enhanced hover effects for better text readability */
  .service-card:hover .services-en-description {
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
  }

  /* Service card background image optimization */
  .service-card {
    min-height: 400px;
  }

  .service-background {
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }

  /* Specific width handling for 1583px and similar resolutions */
  @media (min-width: 1500px) and (max-width: 1650px) {
    .service-background {
      width: 138% !important;
      transform: translateX(-8%);
    }

    .service-background:hover {
      transform: translateX(-32%) !important;
    }
  }

  @media (min-width: 1400px) and (max-width: 1499px) {
    .service-background {
      width: 135% !important;
      transform: translateX(-5%);
    }

    .service-background:hover {
      transform: translateX(-30%) !important;
    }
  }

  @media (min-width: 1651px) and (max-width: 1700px) {
    .service-background {
      width: 136% !important;
      transform: translateX(-6%);
    }

    .service-background:hover {
      transform: translateX(-31%) !important;
    }
  }

  /* For very wide screens */
  @media (min-width: 1700px) {
    .service-background {
      width: 140% !important;
      transform: translateX(-10%);
    }

    .service-background:hover {
      transform: translateX(-35%) !important;
    }
  }

  /* Ensure no gaps on medium-large screens */
  @media (min-width: 1200px) and (max-width: 1399px) {
    .service-background {
      width: 135% !important;
      transform: translateX(-10%);
    }

    .service-background:hover {
      transform: translateX(-28%) !important;
    }
  }

  @media (min-width: 1024px) and (max-width: 1199px) {
    .service-background {
      width: 140% !important;
      transform: translateX(-15%);
    }

    .service-background:hover {
      transform: translateX(-35%) !important;
    }
  }

  /* For smaller desktop screens */
  @media (min-width: 768px) and (max-width: 1023px) {
    .service-background {
      width: 145% !important;
      transform: translateX(-20%);
    }

    .service-background:hover {
      transform: translateX(-40%) !important;
    }
  }
</style>
