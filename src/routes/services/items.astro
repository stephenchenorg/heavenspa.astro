---
import { seoMeta } from '@stephenchenorg/astro/page'
import { graphQLAPI, gql } from '@/api'
import Button from '@/components/ui/Button.astro'
import SectionTitle from '@/components/ui/SectionTitle.astro'
import Layout from '@/layouts/Layout.astro'
import { createNestedT } from '@/utils/i18n'

const t = await createNestedT()

const GET_SERVICES = gql`
  query MyQuery {
    services(page: 1, per_page: 10, search: "") {
      data {
        content_1
        content_2
        content_3
        content_4
        cover
        title
        id
      }
      from
      has_more_pages
      last_page
      per_page
      to
      total
    }
  }
`

const data = await graphQLAPI<{
  services: {
    data: Array<{
      id: string
      title: string
      content_1: string
      content_2: string
      content_3: string
      content_4: string
      cover: string
    }>
    from: number
    has_more_pages: boolean
    last_page: number
    per_page: number
    to: number
    total: number
  }
}>(GET_SERVICES)

const services = data.services.data

const meta = seoMeta({
  title: '服務項目 - Heaven Spa',
  description: '探索 Heaven Spa 的專業服務項目，享受頂級的美容護理體驗。',
})

---

<Layout meta={meta}>
  <main class="section-container">

    <div class="max-w-6xl mx-auto w-full">
      <div class="mb-8">
        <ul class="flex justify-center flex-wrap text-sm font-medium text-center" id="default-tab" role="tablist">
          <li class="me-2 border-b-2 border-transparent" role="presentation">
            <button class="inline-block p-4 border-b-2 border-neutral-900 rounded-t-lg" id="profile-tab" data-tabs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false">
              Profile
            </button>
          </li>
          <li class="me-2 border-b-2 border-transparent" role="presentation">
            <button class="inline-block p-4 border-b-2 border-transparent hover:border-neutral-900 rounded-t-lg transition-all duration-300" id="dashboard-tab" data-tabs-target="#dashboard" type="button" role="tab" aria-controls="dashboard" aria-selected="false">
              Dashboard
            </button>
          </li>
          <li class="me-2 border-b-2 border-transparent" role="presentation">
            <button class="inline-block p-4 border-b-2 border-transparent hover:border-neutral-900 rounded-t-lg transition-all duration-300" id="settings-tab" data-tabs-target="#settings" type="button" role="tab" aria-controls="settings" aria-selected="false">
              Settings
            </button>
          </li>
          <li class="border-b-2 border-transparent" role="presentation">
            <button class="inline-block p-4 border-b-2 border-transparent hover:border-neutral-900 rounded-t-lg transition-all duration-300" id="contacts-tab" data-tabs-target="#contacts" type="button" role="tab" aria-controls="contacts" aria-selected="false">
              Contacts
            </button>
          </li>
        </ul>
      </div>
      <!-- 服務網格 -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 lg:gap-8 mb-8 w-full">
        {services.map(service => (
          <div class="group cursor-pointer transform transition-transform duration-700
                hover:scale-95 active:scale-90 relative backdrop-blur-sm overflow-hidden w-full flex flex-col">
            <a href={`/services/${service.id}`} class="flex flex-col">
              <!-- 上半部：封面圖 -->
              <div class="relative w-full overflow-hidden aspect-[5/6]">
                <!-- Background Image
                  style={`background-image: url('${service.cover}')`}
                 -->
                <div
                  class="absolute inset-0 bg-cover bg-center"
                  style={`background-image: url('https://imagefaker.access.mx.com/1920x1080/282828/eae0d0/?retina=1')`}
                >
                </div>
                <!-- Base Overlay for better text readability -->
                <div class="absolute inset-0 bg-black/20"></div>
                <!-- Hover Overlay -->
                <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>

                <!-- VIEW MORE Button Overlay -->
                <Button
                  variant="ghost"
                  text={t('buttons.view-more')}
                  size="small"
                  icon="→"
                  wrapperClass="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300"
                />
              </div>
              <!-- 標題區域 -->
              <div class="p-4 flex-1 flex items-center">
                <p class="text-neutral-900 font-medium text-lg line-clamp-2">{service.title}</p>
              </div>
            </a>
          </div>
        ))}
      </div>

      <!-- 分頁器 -->
      <div class="flex justify-center items-center space-x-2">
        {Array.from({ length: data.services.last_page }, (_, i) => (
          <button
            class="px-3 py-2 rounded-lg border transition-all duration-300"
            style={i === 0
                    ? 'background-color: var(--color-primary-500); border-color: var(--color-primary-500); color: white;'
                    : 'border-color: var(--theme-border); background-color: var(--theme-card-bg); color: var(--theme-text);'}
          >
            {i + 1}
          </button>
        ))}
      </div>
    </div>

  </main>

  <style>
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .line-clamp-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</Layout>
